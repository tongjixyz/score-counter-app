<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è®¡åˆ†å™¨</title>
    <!-- å¼•å…¥ Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ä½¿ç”¨ Inter å­—ä½“ */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb; /* æµ…ç°è‰²èƒŒæ™¯ */
        }
        /* è‡ªå®šä¹‰æŒ‰é’®æ ·å¼ */
        .score-btn {
            /* æŒ‰é’®å®½åº¦æ›´å®½ï¼Œä»¥é€‚åº”ä¸¤ä¸ªæŒ‰é’®çš„å¸ƒå±€ */
            @apply p-4 text-white text-xl font-bold rounded-xl shadow-lg transition duration-150 ease-in-out transform hover:scale-[1.02] active:scale-95;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <!-- ä¸»å®¹å™¨ -->
    <div class="w-full max-w-4xl bg-white shadow-2xl rounded-3xl p-6 md:p-10 border border-gray-100">
        
        <h1 class="3xl md:text-4xl font-extrabold text-center text-gray-800 mb-8">
            ğŸ† æ¯”èµ›è®¡åˆ†å™¨
        </h1>

        <!-- è®¡åˆ†å¡ç‰‡å®¹å™¨ (Flexbox for responsiveness) -->
        <div class="flex flex-col md:flex-row gap-8 justify-between">
            
            <!-- é˜Ÿä¼ 1 è®¡åˆ†å¡ -->
            <div id="player1Card" class="bg-blue-50 border-2 border-blue-200 rounded-2xl p-6 flex-1 shadow-xl">
                <!-- é˜Ÿåè¾“å…¥æ¡† -->
                <input type="text" id="player1Name" value="é˜Ÿä¼ A" class="w-full text-center text-2xl md:text-3xl font-semibold mb-4 bg-transparent border-b border-blue-300 focus:outline-none focus:border-blue-500 transition" />
                <!-- åˆ†æ•°æ˜¾ç¤º -->
                <div id="player1Score" class="text-7xl md:text-9xl font-extrabold text-center mb-6 text-blue-600 transition duration-300 ease-in-out">0</div>

                <!-- æ§åˆ¶æŒ‰é’® (åªæœ‰ +1 å’Œ -1) -->
                <div class="grid grid-cols-2 gap-4">
                    <button onclick="changeScore(1, -1)" class="score-btn bg-red-500 hover:bg-red-600">
                        -1
                    </button>
                    <button onclick="changeScore(1, 1)" class="score-btn bg-green-500 hover:bg-green-600">
                        +1
                    </button>
                </div>
            </div>

            <!-- åˆ†éš”çº¿ (åªåœ¨æ¡Œé¢æ¨¡å¼æ˜¾ç¤º) -->
            <div class="hidden md:flex items-center">
                <div class="w-1 h-3/4 bg-gray-300 rounded-full"></div>
            </div>

            <!-- é˜Ÿä¼ 2 è®¡åˆ†å¡ -->
            <div id="player2Card" class="bg-red-50 border-2 border-red-200 rounded-2xl p-6 flex-1 shadow-xl">
                <!-- é˜Ÿåè¾“å…¥æ¡† -->
                <input type="text" id="player2Name" value="é˜Ÿä¼ B" class="w-full text-center text-2xl md:text-3xl font-semibold mb-4 bg-transparent border-b border-red-300 focus:outline-none focus:border-red-500 transition" />
                <!-- åˆ†æ•°æ˜¾ç¤º -->
                <div id="player2Score" class="text-7xl md:text-9xl font-extrabold text-center mb-6 text-red-600 transition duration-300 ease-in-out">0</div>
                
                <!-- æ§åˆ¶æŒ‰é’® (åªæœ‰ +1 å’Œ -1) -->
                <div class="grid grid-cols-2 gap-4">
                    <button onclick="changeScore(2, -1)" class="score-btn bg-red-500 hover:bg-red-600">
                        -1
                    </button>
                    <button onclick="changeScore(2, 1)" class="score-btn bg-green-500 hover:bg-green-600">
                        +1
                    </button>
                </div>
            </div>
        </div>

        <!-- æ¸¸æˆæ§åˆ¶åŒº -->
        <!-- æ ¸å¿ƒå®¹å™¨æ”¹ä¸º flex-colï¼Œç¡®ä¿æŒ‰é’®ç»„ã€è®¡æ—¶å™¨ã€æ—¥å¿—å‚ç›´å †å  -->
        <div class="mt-8 pt-6 border-t border-gray-200 flex flex-col items-center gap-6">
            
            <!-- æŒ‰é’®å®¹å™¨ï¼šå¼ºåˆ¶æ¨ªå‘æ’å¸ƒ (flex)ï¼Œå…¨å®½ (w-full)ï¼Œä¸”æœ€å¤§å®½åº¦é™åˆ¶ä¸º mdï¼Œç¡®ä¿ç¾è§‚ -->
            <div class="flex w-full max-w-md gap-4"> 
                <!-- å¼€å§‹/é‡ç½® æŒ‰é’® (flex-1 ç¡®ä¿ç­‰å®½) -->
                <button onclick="resetGame()" class="flex-1 py-4 px-6 text-lg font-semibold bg-yellow-500 text-white rounded-3xl shadow-lg hover:bg-yellow-600 transition duration-200 ease-in-out transform hover:scale-[1.05] active:scale-100">
                    ğŸ”„ å¼€å§‹/é‡ç½®
                </button>

                <!-- å¯¼å‡ºæŒ‰é’® (flex-1 ç¡®ä¿ç­‰å®½) -->
                <button onclick="exportLog()" class="flex-1 py-4 px-6 text-lg font-semibold bg-indigo-500 text-white rounded-3xl shadow-lg hover:bg-indigo-600 transition duration-200 ease-in-out transform hover:scale-[1.05] active:scale-100">
                    ğŸ“¥ å¯¼å‡ºè®°å½•
                </button>
            </div>
            
            <!-- è®¡æ—¶å™¨æ˜¾ç¤ºåŒº (ç”±çˆ¶å®¹å™¨çš„ gap-6 è‡ªåŠ¨æ·»åŠ é—´è·) -->
            <div id="timerDisplay" class="text-lg font-medium text-gray-700">
                <!-- è®¡æ—¶å™¨ä¿¡æ¯å°†åœ¨è¿™é‡Œå®æ—¶æ˜¾ç¤º -->
            </div>

            <!-- åˆ†æ•°æ—¥å¿—åŒºåŸŸ (ä¿æŒå…¨å®½) -->
            <div id="logContainer" class="w-full max-w-4xl p-4 bg-gray-100 rounded-xl shadow-inner">
                <!-- Log entries will be inserted here by JavaScript -->
            </div>
        </div>

    </div>

    <script>
        // --- çŠ¶æ€å˜é‡ ---
        let score1 = 0; // é˜Ÿä¼ A çš„åˆ†æ•°
        let score2 = 0; // é˜Ÿä¼ B çš„åˆ†æ•°
        let log1 = [];
        let log2 = [];
        let startTime = null; // æ¯”èµ›å¼€å§‹æ—¶é—´æˆ³ (ç¬¬ä¸€æ¬¡æ“ä½œæˆ–é‡ç½®æ—¶è®¾ç½®)
        let timerInterval = null; // è®¡æ—¶å™¨ interval ID

        // --- LocalStorage Keys for Persistence ---
        const STORAGE_KEY_SCORE1 = 'scoreCounter_score1';
        const STORAGE_KEY_SCORE2 = 'scoreCounter_score2';
        const STORAGE_KEY_LOG1 = 'scoreCounter_log1';
        const STORAGE_KEY_LOG2 = 'scoreCounter_log2';
        const STORAGE_KEY_START_TIME = 'scoreCounter_startTime'; // æ–°å¢è®¡æ—¶é”®


        /**
         * æ ¼å¼åŒ–æ¯«ç§’æ•°ä¸º å¤©/æ—¶/åˆ†/ç§’ çš„å­—ç¬¦ä¸²
         * @param {number} ms - æ¯«ç§’æ•°
         * @returns {string} æ ¼å¼åŒ–åçš„æ—¶é—´å­—ç¬¦ä¸²
         */
        function formatDuration(ms) {
            if (ms < 0) ms = 0;
            const totalSeconds = Math.floor(ms / 1000);
            
            const days = Math.floor(totalSeconds / (3600 * 24));
            const hours = Math.floor((totalSeconds % (3600 * 24)) / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;

            let result = '';
            if (days > 0) result += `${days}å¤©`;
            result += `${String(hours).padStart(2, '0')}æ—¶`;
            result += `${String(minutes).padStart(2, '0')}åˆ†`;
            result += `${String(seconds).padStart(2, '0')}ç§’`;
            
            return result;
        }
        
        /**
         * æ ¼å¼åŒ–æ—¶é—´æˆ³ä¸º YYYY/MM/DD HH:MM:SS å­—ç¬¦ä¸²ã€‚
         * @param {number} timestamp - æ¯«ç§’æ—¶é—´æˆ³ã€‚
         * @returns {string} æ ¼å¼åŒ–åçš„æ—¥æœŸæ—¶é—´å­—ç¬¦ä¸²ã€‚
         */
        function formatDateTime(timestamp) {
            if (timestamp === null) return 'N/A';
            const date = new Date(timestamp);
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            const seconds = String(date.getSeconds()).padStart(2, '0');
            return `${year}/${month}/${day} ${hours}:${minutes}:${seconds}`;
        }
        
        /**
         * å¯åŠ¨æˆ–é‡å¯å®æ—¶è®¡æ—¶å™¨ã€‚
         */
        function startTimer() {
            // å…ˆæ¸…é™¤ä»»ä½•ç°æœ‰çš„è®¡æ—¶å™¨
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            
            if (startTime !== null) {
                // ç«‹å³æ›´æ–°ä¸€æ¬¡æ˜¾ç¤º
                updateTimerDisplay();
                // æ¯ç§’æ›´æ–°ä¸€æ¬¡æ˜¾ç¤º
                timerInterval = setInterval(updateTimerDisplay, 1000);
            } else {
                // å¦‚æœæ²¡æœ‰å¼€å§‹æ—¶é—´ï¼Œåˆ™æ˜¾ç¤ºæœªå¼€å§‹
                document.getElementById('timerDisplay').textContent = "æ¸¸æˆçŠ¶æ€: æœªå¼€å§‹";
            }
        }
        
        /**
         * è®¡ç®—å¹¶æ›´æ–°è®¡æ—¶å™¨æ˜¾ç¤ºã€‚
         */
        function updateTimerDisplay() {
            if (startTime === null) {
                // å¦‚æœè®¡æ—¶è¢«åœæ­¢ï¼Œç¡®ä¿æ˜¾ç¤ºæ­£ç¡®çš„åˆå§‹çŠ¶æ€
                document.getElementById('timerDisplay').textContent = "æ¸¸æˆçŠ¶æ€: æœªå¼€å§‹";
                clearInterval(timerInterval);
                timerInterval = null;
                return;
            }
            
            const durationMs = Date.now() - startTime;
            const duration = formatDuration(durationMs);
            document.getElementById('timerDisplay').textContent = `å·²æŒç»­è®¡æ—¶: ${duration}`;
        }


        /**
         * æ›´æ–°æŒ‡å®šé˜Ÿä¼çš„åˆ†æ•°æ˜¾ç¤ºã€‚
         * @param {number} player - é˜Ÿä¼ç¼–å· (1 æˆ– 2)ã€‚
         */
        function updateScoreDisplay(player) {
            const scoreElement = document.getElementById(`player${player}Score`);
            const currentScore = player === 1 ? score1 : score2;
            
            scoreElement.textContent = currentScore;
            // æ·»åŠ ä¸€ä¸ªå¾®å°çš„åŠ¨ç”»æ•ˆæœ
            scoreElement.classList.add('scale-105');
            setTimeout(() => {
                scoreElement.classList.remove('scale-105');
            }, 150);
        }

        /**
         * æ›´æ–°å¾—åˆ†è®°å½•åˆ—è¡¨ã€‚
         */
        function updateLogDisplay() {
            const logContainer = document.getElementById('logContainer');
            const name1 = document.getElementById('player1Name').value;
            const name2 = document.getElementById('player2Name').value;

            // åˆå¹¶å¹¶æŒ‰æ—¶é—´æˆ³é™åºæ’åˆ— (æœ€æ–°çš„åœ¨æœ€ä¸Šé¢)
            const combinedLog = [
                ...log1.map(item => ({ ...item, player: 1, name: name1, color: 'text-blue-600' })),
                ...log2.map(item => ({ ...item, player: 2, name: name2, color: 'text-red-600' }))
            ].sort((a, b) => {
                return a.timestamp - b.timestamp;
            }).reverse();
            
            // åªæ˜¾ç¤ºæœ€è¿‘çš„ 15 æ¡è®°å½•
            const recentLog = combinedLog.slice(0, 15);

            let logHtml = `<h2 class="text-xl font-bold text-gray-700 mb-4 text-center">æœ€è¿‘ ${recentLog.length} æ¡å¾—åˆ†è®°å½•</h2>`;
            
            if (recentLog.length === 0) {
                logHtml += '<p class="text-gray-500 italic text-center">æš‚æ— è®°å½•ã€‚</p>';
            } else {
                logHtml += '<ul class="space-y-2">';
                recentLog.forEach(entry => {
                    const action = entry.amount > 0 ? 'å¾—åˆ†' : 'æ‰£åˆ†';
                    const amountText = entry.amount > 0 ? `+${entry.amount}` : `${entry.amount}`;
                    const colorClass = entry.amount > 0 ? 'text-green-600' : 'text-red-600';
                    
                    logHtml += `
                        <li class="flex justify-between items-center p-3 bg-white rounded-lg shadow-sm border-l-4 ${entry.player === 1 ? 'border-blue-500' : 'border-red-500'}">
                            <span class="text-sm font-medium text-gray-500 w-1/4 md:w-auto">${entry.time}</span>
                            <span class="${entry.color} font-bold w-1/4 md:w-auto truncate">${entry.name}</span>
                            <span class="${colorClass} font-semibold w-1/4 text-right">${action} ${amountText}</span>
                            <span class="text-sm text-gray-700 w-1/4 text-right">æ¯”åˆ†: ${entry.scoreA} - ${entry.scoreB}</span>
                        </li>
                    `;
                });
                logHtml += '</ul>';
            }

            logContainer.innerHTML = logHtml;
        }

        /**
         * ä¿å­˜å½“å‰çŠ¶æ€åˆ° localStorageã€‚
         */
        function saveState() {
            try {
                localStorage.setItem(STORAGE_KEY_SCORE1, score1);
                localStorage.setItem(STORAGE_KEY_SCORE2, score2);
                localStorage.setItem(STORAGE_KEY_LOG1, JSON.stringify(log1));
                localStorage.setItem(STORAGE_KEY_LOG2, JSON.stringify(log2));
                // ä¿å­˜å¼€å§‹æ—¶é—´
                if (startTime !== null) {
                    localStorage.setItem(STORAGE_KEY_START_TIME, startTime);
                } else {
                    localStorage.removeItem(STORAGE_KEY_START_TIME);
                }
            } catch (e) {
                console.error("Failed to save state to localStorage:", e);
            }
        }

        /**
         * ä» localStorage åŠ è½½çŠ¶æ€ã€‚
         */
        function loadState() {
            try {
                const storedScore1 = localStorage.getItem(STORAGE_KEY_SCORE1);
                const storedScore2 = localStorage.getItem(STORAGE_KEY_SCORE2);
                const storedLog1 = localStorage.getItem(STORAGE_KEY_LOG1);
                const storedLog2 = localStorage.getItem(STORAGE_KEY_LOG2);
                const storedStartTime = localStorage.getItem(STORAGE_KEY_START_TIME);

                if (storedScore1 !== null) score1 = parseInt(storedScore1, 10) || 0;
                if (storedScore2 !== null) score2 = parseInt(storedScore2, 10) || 0;
                if (storedLog1 !== null) log1 = JSON.parse(storedLog1) || [];
                if (storedLog2 !== null) log2 = JSON.parse(storedLog2) || [];
                // åŠ è½½å¼€å§‹æ—¶é—´
                if (storedStartTime !== null) {
                    startTime = parseInt(storedStartTime, 10);
                } else {
                    startTime = null; 
                }
            } catch (e) {
                console.error("Failed to load state from localStorage, resetting to default:", e);
                score1 = 0;
                score2 = 0;
                log1 = [];
                log2 = [];
                startTime = null;
            }
        }


        /**
         * æ”¹å˜æŒ‡å®šé˜Ÿä¼çš„åˆ†æ•°ã€‚
         * @param {number} player - é˜Ÿä¼ç¼–å· (1 æˆ– 2)ã€‚
         * @param {number} amount - åˆ†æ•°å˜åŒ–é‡ (å¯ä¸ºæ­£æˆ–è´Ÿ)ã€‚
         */
        function changeScore(player, amount) {
            const now = new Date();
            const wasStartTimeNull = (startTime === null);

            // å¦‚æœ startTime ä¸ºç©ºï¼Œåˆ™è®¾ç½®å½“å‰æ—¶é—´ä¸ºæ¸¸æˆå¼€å§‹æ—¶é—´
            if (wasStartTimeNull) {
                startTime = now.getTime();
            }

            // æ ¼å¼åŒ–æ—¶é—´ä¸º HH:MM:SS
            const timeString = now.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            
            if (player === 1) {
                score1 += amount;
                if (score1 < 0) score1 = 0; // é˜²æ­¢è´Ÿåˆ†
                log1.push({ time: timeString, amount: amount, scoreA: score1, scoreB: score2, timestamp: now.getTime() });
            } else if (player === 2) {
                score2 += amount;
                if (score2 < 0) score2 = 0; // é˜²æ­¢è´Ÿåˆ†
                log2.push({ time: timeString, amount: amount, scoreA: score1, scoreB: score2, timestamp: now.getTime() });
            }
            
            if (wasStartTimeNull) {
                startTimer(); // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡æ“ä½œï¼Œå¯åŠ¨è®¡æ—¶å™¨
            }

            updateScoreDisplay(player);
            updateLogDisplay(); // æ›´æ–°æ—¥å¿—æ˜¾ç¤º
            saveState(); // æ¯æ¬¡åˆ†æ•°å˜åŠ¨åä¿å­˜çŠ¶æ€
        }

        /**
         * å¯¼å‡ºæ‰€æœ‰åˆ†æ•°è®°å½•ä¸º çº¯æ–‡æœ¬ (TXT) æ–‡ä»¶ã€‚
         */
        function exportLog() {
            if (log1.length === 0 && log2.length === 0) {
                showCustomMessage("æ²¡æœ‰å¯å¯¼å‡ºçš„è®°å½•ã€‚", "bg-yellow-100 border-yellow-500 text-yellow-700");
                return;
            }

            const name1 = document.getElementById('player1Name').value;
            const name2 = document.getElementById('player2Name').value;

            // Combine and sort log entries by timestamp in ASCENDING order for chronological export
            const combinedLog = [
                ...log1.map(item => ({ ...item, player: 1, name: name1 })),
                ...log2.map(item => ({ ...item, player: 2, name: name2 }))
            ].sort((a, b) => a.timestamp - b.timestamp); 

            // --- PLAIN TEXT EXPORT LOGIC ---
            const nowTime = Date.now();
            
            // æ ¼å¼åŒ–å¼€å§‹å’Œç»“æŸæ—¥æœŸ
            const dateFormatOptions = { year: 'numeric', month: '2-digit', day: '2-digit' };
            const startDateStr = startTime ? new Date(startTime).toLocaleDateString('zh-CN', dateFormatOptions) : 'N/A';
            const endDateStr = new Date(nowTime).toLocaleDateString('zh-CN', dateFormatOptions);

            // ç¡®å®šæ ‡é¢˜æ—¥æœŸèŒƒå›´ï¼šå¦‚æœè·¨å¤©ï¼Œæ˜¾ç¤º "å¼€å§‹æ—¥æœŸ - ç»“æŸæ—¥æœŸ"
            let titleDateRange = endDateStr;
            if (startTime && startDateStr !== endDateStr) {
                titleDateRange = `${startDateStr} - ${endDateStr}`;
            } else if (startTime) {
                 // åŒä¸€å¤©ï¼Œåªæ˜¾ç¤ºå¼€å§‹æ—¥æœŸ
                titleDateRange = startDateStr;
            }

            // è®¡ç®—å¹¶æ ¼å¼åŒ–æ€»æ—¶é•¿
            let durationString = 'N/A';
            if (startTime !== null) {
                const durationMs = nowTime - startTime;
                durationString = formatDuration(durationMs);
            }
            
            // è·å–ç²¾ç¡®çš„å¼€å§‹å’Œç»“æŸæ—¶é—´
            const startDateTimeStr = startTime !== null ? formatDateTime(startTime) : 'N/A (æ— è®°å½•)';
            const endDateTimeStr = formatDateTime(nowTime);

            
            // å®šä¹‰åˆ—å®½ (åŸºäºæ ‡å‡†ç©ºæ ¼å­—ç¬¦æ•°ï¼Œæ–¹ä¾¿å¯¹é½)
            const W_IDX = 5;
            const W_TIME = 8;
            const W_NAME = 12; // å¢åŠ å®½åº¦ä»¥é€‚åº”ä¸­æ–‡å’Œé˜Ÿå
            const W_AMOUNT = 6;
            const W_SCORE = 10;
            const SEPARATOR = " | ";
            
            // çº¯æ–‡æœ¬æ–‡ä»¶å¤´
            let textContent = `æ¯”èµ›å¾—åˆ†è®°å½• - ${titleDateRange}\n`; // ä½¿ç”¨æ–°çš„æ—¥æœŸèŒƒå›´æ ‡é¢˜
            textContent += `é˜Ÿä¼ A: ${name1}\né˜Ÿä¼ B: ${name2}\n`;
            textContent += `å¼€å§‹æ—¶é—´: ${startDateTimeStr}\n`; // æ–°å¢å¼€å§‹æ—¶é—´
            textContent += `ç»“æŸæ—¶é—´: ${endDateTimeStr}\n`; // æ–°å¢ç»“æŸæ—¶é—´
            textContent += `è®¡æ—¶æ—¶é•¿: ${durationString}\n`; // åœ¨å¤´éƒ¨æ·»åŠ æ€»è®¡æ—¶
            textContent += "====================================================================\n\n";

            // Header row: ä½¿ç”¨ padEnd å®ç°å·¦å¯¹é½
            let header = "";
            header += "åºå·".padEnd(W_IDX, ' ');
            header += SEPARATOR;
            header += "æ—¶é—´".padEnd(W_TIME, ' ');
            header += SEPARATOR;
            header += "é˜Ÿä¼".padEnd(W_NAME, ' ');
            header += SEPARATOR;
            header += "å˜åŒ–é‡".padEnd(W_AMOUNT, ' ');
            header += SEPARATOR;
            header += "æœ€ç»ˆæ¯”åˆ†"; 
            
            textContent += header + "\n";
            // ç”Ÿæˆåˆ†éš”çº¿ï¼Œç¡®ä¿é•¿åº¦ä¸åˆ—å®½åŒ¹é…
            const LINE_SEP = "-".repeat(W_IDX + SEPARATOR.length + W_TIME + SEPARATOR.length + W_NAME + SEPARATOR.length + W_AMOUNT + SEPARATOR.length + W_SCORE);
            textContent += LINE_SEP + "\n";


            // Map log entries to Plain Text rows
            combinedLog.forEach((entry, index) => {
                const amountText = entry.amount > 0 ? `+${entry.amount}` : `${entry.amount}`;
                const scoreText = `${entry.scoreA} - ${entry.scoreB}`;
                
                // Data rows using String padding for alignment (padEndå®ç°å·¦å¯¹é½)
                let dataRow = "";
                dataRow += String(index + 1).padEnd(W_IDX, ' ');
                dataRow += SEPARATOR;
                dataRow += entry.time.padEnd(W_TIME, ' ');
                dataRow += SEPARATOR;
                dataRow += entry.name.padEnd(W_NAME, ' '); 
                dataRow += SEPARATOR;
                dataRow += amountText.padEnd(W_AMOUNT, ' ');
                dataRow += SEPARATOR;
                dataRow += scoreText;

                textContent += dataRow + "\n";
            });
            textContent += "\n====================================================================\n";

            // Create a Blob and trigger download
            const blob = new Blob([textContent], { type: 'text/plain;charset=utf-8;' });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            
            link.setAttribute("href", url);
            
            // File name: ScoreLog-YYYYMMDD.txt (ä»¥å¯¼å‡ºæ—¶çš„æ—¥æœŸå‘½å)
            const dateStr = new Date(nowTime).toISOString().slice(0, 10).replace(/-/g, '');
            link.setAttribute("download", `ScoreLog-${dateStr}.txt`);
            
            // éšè—é“¾æ¥å¹¶ç‚¹å‡»è§¦å‘ä¸‹è½½
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            showCustomMessage("è®°å½•å·²æˆåŠŸå¯¼å‡ºä¸º TXT æ–‡ä»¶ï¼", "bg-green-100 border-green-500 text-green-700");
        }

        /**
         * é‡ç½®æ‰€æœ‰åˆ†æ•°ã€æ—¥å¿—å’Œåç§°ã€‚
         */
        function resetGame() {
            score1 = 0;
            score2 = 0;
            log1 = []; 
            log2 = []; 
            startTime = Date.now(); // é‡ç½®æ¸¸æˆæ—¶ï¼Œé‡æ–°è®¾ç½®å¼€å§‹æ—¶é—´

            // æ¸…é™¤ localStorage ä¸­çš„æ•°æ®ï¼Œå®ç°å½»åº•é‡ç½®
            localStorage.removeItem(STORAGE_KEY_SCORE1);
            localStorage.removeItem(STORAGE_KEY_SCORE2);
            localStorage.removeItem(STORAGE_KEY_LOG1);
            localStorage.removeItem(STORAGE_KEY_LOG2);
            
            // ç¡®ä¿ä¿å­˜æ–°çš„ startTime
            saveState();

            updateScoreDisplay(1);
            updateScoreDisplay(2);
            updateLogDisplay(); // æ›´æ–°æ—¥å¿—è§†å›¾
            
            // å¯åŠ¨æˆ–é‡å¯è®¡æ—¶å™¨
            startTimer();
            
            // é‡ç½®åç§°
            document.getElementById('player1Name').value = 'é˜Ÿä¼ A';
            document.getElementById('player2Name').value = 'é˜Ÿä¼ B';

            // å¼¹å‡ºæç¤ºæ¡† (ä½¿ç”¨è‡ªå®šä¹‰çš„ç®€å•æç¤ºä»£æ›¿alert)
            showCustomMessage("æ¸¸æˆå·²é‡ç½®ï¼Œè®¡æ—¶å·²é‡æ–°å¼€å§‹ï¼", "bg-yellow-100 border-yellow-500 text-yellow-700");
        }

        /**
         * æ˜¾ç¤ºä¸€ä¸ªè‡ªå®šä¹‰çš„çŸ­æš‚æç¤ºä¿¡æ¯ï¼Œä»£æ›¿ alert()ã€‚
         */
        function showCustomMessage(message, tailwindClasses) {
            let messageBox = document.getElementById('customMessageBox');
            if (!messageBox) {
                messageBox = document.createElement('div');
                messageBox.id = 'customMessageBox';
                messageBox.className = 'fixed top-4 left-1/2 transform -translate-x-1/2 z-50 p-4 rounded-xl shadow-2xl transition-opacity duration-300 opacity-0';
                document.body.appendChild(messageBox);
            }

            messageBox.className = `fixed top-4 left-1/2 transform -translate-x-1/2 z-50 p-4 rounded-xl shadow-2xl transition-opacity duration-300 ${tailwindClasses}`;
            messageBox.textContent = message;
            
            messageBox.classList.remove('opacity-0');
            messageBox.classList.add('opacity-100');

            setTimeout(() => {
                messageBox.classList.remove('opacity-100');
                messageBox.classList.add('opacity-0');
            }, 3000);
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–æ˜¾ç¤º
        window.onload = function() {
            loadState(); // 1. åŠ è½½ä¸Šæ¬¡ä¿å­˜çš„çŠ¶æ€
            updateScoreDisplay(1); // 2. æ›´æ–°åˆ†æ•°æ˜¾ç¤º
            updateScoreDisplay(2);
            updateLogDisplay(); // 3. æ›´æ–°æ—¥å¿—åŒºåŸŸ
            
            // 4. å¯åŠ¨åŠ¨æ€è®¡æ—¶å™¨ï¼ˆå¦‚æœè®¡æ—¶å·²å¼€å§‹ï¼‰
            startTimer();
        };
    </script>
</body>
</html>
